!function(){d3.svg.transform=function(a){function c(a,c){var e=c.length;b.push(function(){return a+"("+(1==e&&"function"==typeof c[0]?c[0].apply(this,d(arguments)):c)+")"})}function d(a){return Array.prototype.slice.call(a)}var e,b=[];return void 0!==a&&b.push(a),e=function(){var a=this,c=d(arguments);return b.map(function(b){return b.apply(a,c)}).join(" ")},["translate","rotate","scale","matrix","skewX","skewY"].forEach(function(a){e[a]=function(){return c(a,d(arguments)),e}}),e}}(),$.extend(Array.prototype,{min:function(){return this.reduce(function(a,b){return b>a?a:b})},max:function(){return this.reduce(function(a,b){return a>b?a:b})},minBy:function(a){var b=[];return $.each(this,function(c,d){b.push(d[a])}),b.min()},maxBy:function(a){var b=[];return $.each(this,function(c,d){b.push(d[a])}),b.max()},toArray:function(a){var b=[];return $.each(this,function(c,d){b.push(d[a])}),b},shuffle:function(){for(var b,c,a=this.length;a;)c=Math.floor(Math.random()*a--),b=this[a],this[a]=this[c],this[c]=b;return this},distinct:function(){var a=[];return $.each(this,function(b,c){-1==$.inArray(c,a)&&a.push(c)}),a},findFirst:function(a,b){var c=void 0;return $.each(this,function(d,e){var f=void 0===b?e:e[b];return f===a?(c=d,!1):void 0}),this[c]}}),function(){$.misc={uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"==a?b:8|3&b;return c.toString(16)})}}}(),function(){var b,a=function(){};a.prototype={on:function(a,b,c){var d=this;d.notifications=this.notifications||{},d.notifications[a]=d.notifications[a]||[],d.notifications[a].push({handler:b,able:c})},off:function(a,b){var e,c=this,d=arguments.length;return 0===d?delete c.notifications:1===d?delete c.notifications[a]:(c.notifications=c.notifications||{},e=c.notifications[a]||[],$.each(e,function(d,e){return e.handler===b?(c.notifications[a].splice(d,1),!1):void 0}),void 0)},send:function(){var c,d,a=arguments[0],b=this;b.notifications=b.notifications||{},b.notifications[a]=b.notifications[a]||[],c=b.notifications[a],d=Array.prototype.slice.call(arguments,1),$.each(c,function(a,b){var c=void 0===b.able||b.able.apply(null,d);c&&b.handler.apply(null,d)})}},b={},$.microObserver={create:function(c){return b[c]=new a,b[c]},get:function(a){var c=this;return b[a]||c.create(a)}}}(),function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.MicroPlugin=b()}(this,function(){var b,a={};return a.mixin=function(a){a.plugins={},a.prototype.initializePlugins=function(a){var c,d,e,f=this,g=[];if(f.plugins={names:[],settings:{},requested:{},loaded:{}},b.isArray(a))for(c=0,d=a.length;d>c;c++)"string"==typeof a[c]?g.push(a[c]):(f.plugins.settings[a[c].name]=a[c].options,g.push(a[c].name));else if(a)for(e in a)a.hasOwnProperty(e)&&(f.plugins.settings[e]=a[e],g.push(e));for(;g.length;)f.require(g.shift())},a.prototype.loadPlugin=function(b){var c=this,d=c.plugins,e=a.plugins[b];if(!a.plugins.hasOwnProperty(b))throw new Error('Unable to find "'+b+'" plugin');d.requested[b]=!0,d.loaded[b]=e.fn.apply(c,[c.plugins.settings[b]||{}]),d.names.push(b)},a.prototype.require=function(a){var b=this,c=b.plugins;if(!b.plugins.loaded.hasOwnProperty(a)){if(c.requested[a])throw new Error('Plugin has circular dependency ("'+a+'")');b.loadPlugin(a)}return c.loaded[a]},a.define=function(b,c){a.plugins[b]={name:b,fn:c}}},b={isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}},a}),function(a,b){"function"==typeof define&&define.amd?define(["microplugin"],b):"object"==typeof exports?module.exports=b(require("microplugin")):a.BubbleChart=b(a.MicroPlugin)}(this,function(a){var b=2*Math.PI;return d3.svg.BubbleChart=function(a){var b=this,c=a.size,d=a.size/3,e=a.size/2,f=a.size/10;b.options={},$.extend(b.options,{plugins:[],container:".bubbleChart",viewBoxSize:c,innerRadius:d,outerRadius:e,radiusMin:f,intersectDelta:0,transitDuration:1e3},a),$.extend(b.options,{radiusMax:(b.options.outerRadius-b.options.innerRadius)/2,intersectInc:b.options.intersectDelta},a),b.initializePlugins(b.options.plugins),b.setup(),b.registerClickEvent(b.getNodes()),b.moveToCentral(d3.select(".node"))},$.extend(d3.svg.BubbleChart.prototype,{getTransition:function(){return this.transition},getClickedNode:function(){return this.clickedNode},getCentralNode:function(){return this.centralNode},getOptions:function(){return this.options},randomCirclesPositions:function(a){for(var g,h,i,j,k,l,m,c=this,d=[],e=0,f=c.options;d.length<c.items.length&&++e<c.intervalMax;)g=c.values[d.length],h=Math.max(g*f.radiusMax/c.valueMax,f.radiusMin),i=c.innerRadius+h+Math.random()*(c.outerRadius-c.innerRadius-2*h),j=Math.random()*b,k=c.centralPoint+i*Math.cos(j),l=c.centralPoint+i*Math.sin(j),m=!1,$.each(d,function(b,c){var d=c.cx-k,e=c.cy-l,f=c.r+h;return d*d+e*e<Math.pow(f-a,2)?(m=!0,!1):void 0}),m||d.push({cx:k,cy:l,r:h,item:c.items[d.length]});if(d.length<c.items.length){if(a===f.radiusMin)throw{message:"Not enough space for all bubble. Please change the options.",options:f};return c.randomCirclesPositions(a+f.intersectInc)}return d.shuffle()},getValues:function(){var a=[],b=this;return $.each(b.items,function(c,d){a.push(b.options.data.eval(d))}),a},setup:function(){var c,d,a=this,b=a.options;a.innerRadius=b.innerRadius,a.outerRadius=b.outerRadius,a.centralPoint=b.size/2,a.intervalMax=b.size*b.size,a.items=b.data.items,a.values=a.getValues(),a.valueMax=a.values.max(),a.svg=d3.select(b.container).append("svg").attr({preserveAspectRatio:"xMidYMid",width:b.size,height:b.size,"class":"bubbleChart"}).attr("viewBox",function(){return["0 0",b.viewBoxSize,b.viewBoxSize].join(" ")}),a.circlePositions=a.randomCirclesPositions(b.intersectDelta),c=a.svg.selectAll(".node").data(a.circlePositions).enter().append("g").attr("class",function(a){return["node",b.data.classed(a.item)].join(" ")}),d=d3.scale.category20(),c.append("circle").attr({r:function(a){return a.r},cx:function(a){return a.cx},cy:function(a){return a.cy}}).style("fill",function(a){return void 0!==b.data.color?b.data.color(a.item):d(a.item.text)}).attr("opacity","0.8"),c.sort(function(a,c){return b.data.eval(c.item)-b.data.eval(a.item)}),a.transition={},a.event=$.microObserver.get($.misc.uuid()),b.supportResponsive&&($(window).resize(function(){var c=$(b.container).width();a.svg.attr("width",c),a.svg.attr("height",c)}),$(window).resize())},getCirclePositions:function(){return this.circlePositions},moveToCentral:function(a){var b=this,c=d3.svg.transform().translate(function(c){var e,f;return a.select("circle").attr("cx"),e=b.centralPoint-c.cx,f=b.centralPoint-c.cy,[e,f]});b.centralNode=a,b.transition.centralNode=a.classed({active:!0}).transition().duration(b.options.transitDuration),b.transition.centralNode.attr("transform",c).select("circle").attr("r",function(){return b.options.innerRadius})},moveToReflection:function(a,b){var c=this,d=d3.svg.transform().translate(function(a){var b=2*(c.centralPoint-a.cx),d=2*(c.centralPoint-a.cy);return[b,d]});a.transition().duration(c.options.transitDuration).delay(function(a,b){return 10*b}).attr("transform",b?"":d).select("circle").attr("r",function(a){return a.r})},reset:function(a){a.classed({active:!1})},registerClickEvent:function(a){var b=this,c=!1;a.style("cursor","pointer").on("click",function(){b.clickedNode=d3.select(this),b.event.send("click",b.clickedNode),b.reset(b.centralNode),b.moveToCentral(b.clickedNode),b.moveToReflection(b.svg.selectAll(".node:not(.active)"),c),c=!c})},getNodes:function(){return this.svg.selectAll(".node")},get:function(){return this.svg}}),a.mixin(d3.svg.BubbleChart),d3.svg.BubbleChart}),d3.svg.BubbleChart.define("central-click",function(a){var b=this;b.setup=function(){var c=b.setup;return function(){var d=c.apply(this,arguments);return b.event.on("click",function(a){1===a.selectAll("text.central-click")[0].length}),d}}(),b.reset=function(){var c=b.reset;return function(a){var b=c.apply(this,arguments);return a.select("text.central-click").remove(),b}}(),b.moveToCentral=function(){var d=b.moveToCentral;return function(c){var e=d.apply(this,arguments),f=b.getTransition().centralNode;return f.each("end",function(){c.append("text").classed({"central-click":!0}).attr(a.attr).style(a.style).attr("x",function(a){return a.cx}).attr("y",function(a){return a.cy}).text(a.text).style("opacity",0).transition().duration(b.getOptions().transitDuration/2).style("opacity","0.8")}),e}}()}),d3.svg.BubbleChart.define("lines",function(a){var b=this;b.setup=function(){var c=b.setup;return function(){var d=c.apply(this,arguments),e=b.getNodes();return $.each(a.format,function(a,b){e.append("text").classed(b.classed).style(b.style).attr(b.attr).text(function(a){return a.item[b.textField]})}),d}}(),b.reset=function(){var d=b.reset;return function(c){var e=d.apply(this,arguments);return $.each(a.format,function(a,d){var e=d3.select(c.selectAll("text")[0][a]);e.classed(d.classed).text(function(a){return a.item[d.textField]}).transition().duration(b.getOptions().transitDuration).style(d.style).attr(d.attr)}),e}}(),b.moveToCentral=function(){var d=b.moveToCentral;return function(c){var e=d.apply(this,arguments);return $.each(a.centralFormat,function(a,d){var e=d3.select(c.selectAll("text")[0][a]);e.transition().duration(b.getOptions().transitDuration).style(d.style).attr(d.attr),void 0!==d.classed&&e.classed(d.classed),void 0!==d.textField&&e.text(function(a){return a.item[d.textField]})}),e}}()});